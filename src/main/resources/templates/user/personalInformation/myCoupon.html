<!DOCTYPE html>
<html lang="ch" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„å„ªæƒ åˆ¸</title>
    <!-- å¼•å…¥ Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
</head>
<style>
    /* å·²éæœŸå„ªæƒ åˆ¸æ¨£å¼ */
    .expired-coupon {
        color: #666;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        text-decoration: line-through;
        opacity: 0.6;
    }

    /* æœªé–‹å§‹å„ªæƒ åˆ¸æ¨£å¼ */
    .not-started-coupon {
        color: #333;
        background-color: #ffeb3b;
        border: 1px solid #ffd600;
        opacity: 0.6;
    }
</style>
<body>
<div class="container mt-4">
    <h2>æˆ‘çš„å„ªæƒ åˆ¸</h2>
    <div th:if="${coupons.empty}" class="text-center">
        <h5 class="mt-5">ç„¡ä»»ä½•å„ªæƒ åˆ¸ ğŸ¥±</h5>
    </div>
    <div class="row row-cols-1 row-cols-md-3 g-4">
        <div th:each="coupon : ${coupons}" class="col">
            <div class="card h-100 position-relative" th:classappend="${coupon.status == 'expired' ? 'expired-coupon' : coupon.status == 'notStarted' ? 'not-started-coupon' : 'bg-primary'}">
                <!-- åˆªé™¤æŒ‰éˆ• -->
                <button type="button" class="btn-close position-absolute top-0 end-0 m-2" aria-label="Close"
                        th:data-coupon-id="${coupon.couponId}"
                        th:onclick="'deleteCoupon(this,' + ${user.userId} + ')'"></button>

                <div class="card-body">
                    <h5 class="card-title" th:text="${coupon.code}">å„ªæƒ åˆ¸ä»£ç¢¼</h5>
                    <p class="card-text mb-1" th:text="${coupon.description}">æè¿°</p>
                    <small th:text="${coupon.discountType.name() == 'FIXED' ? 'æŠ˜æ‰£: ' + #numbers.formatDecimal(coupon.discountValue, 1, 0) + 'å…ƒ' : 'æŠ˜æ‰£: ' + coupon.discountValue + '%'}"></small>
                </div>
                <div class="card-footer">
                    <small class="text" th:text="${coupon.startDate} + ' ~ ' + ${coupon.endDate}">æˆªæ­¢æ—¥æœŸ</small>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- å¯é¸ï¼šå¼•å…¥ Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function deleteCoupon(button, userId) {
        var couponId = button.getAttribute('data-coupon-id');

        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        Swal.fire({
            title: 'ç¢ºå®šè¦åˆªé™¤å—?',
            text: "æ‚¨å°‡ç„¡æ³•æ¢å¾©æ­¤æ“ä½œï¼",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'æ˜¯çš„ï¼Œåˆªé™¤å®ƒï¼',
            cancelButtonText: 'å–æ¶ˆ',
            backdrop: false // ç¦ç”¨èƒŒæ™¯é®ç½©
        }).then((result) => {
            if (result.isConfirmed) {
                // ç”¨æˆ·ç¡®è®¤åˆ é™¤
                fetch('/deleteCoupon/' + couponId + '/' + userId, {
                    method: 'DELETE'
                })
                    .then(response => {
                        if(response.ok) {
                            Swal.fire({
                                title: 'åˆªé™¤!',
                                text: 'æ‚¨çš„å„ªæƒ åˆ¸å·²è¢«åˆªé™¤ã€‚',
                                icon: 'success',
                                backdrop: false // ç¦ç”¨èƒŒæ™¯é®ç½©
                            })
                                .then((result) => {
                                    if (result.isConfirmed) {
                                        window.location.reload(); // åœ¨è¿™é‡Œé‡æ–°åŠ è½½é¡µé¢
                                    }
                                });
                        } else {
                            throw new Error('Something went wrong');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire('Error!', 'ç„¡æ³•åˆªé™¤å„ªæƒ åˆ¸ã€‚', 'error');
                    });
            }
        });
    }
</script>


</body>
</html>
